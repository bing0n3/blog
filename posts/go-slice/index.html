<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=bing0ne><meta name=description content=在刷leetcode的78题的时候，遇到了对slice进行append的bug。><meta name=keywords content=blog,bing0ne,gopher,gsoc><link rel=canonical href=https://blog.bing0ne.com/posts/go-slice/><title>Go中Slice的总结 &middot; bing0ne Base</title><link rel="shortcut icon" href=https://blog.bing0ne.com/images/favicon.ico><link rel=stylesheet href=https://blog.bing0ne.com/css/animate.min.css><link rel=stylesheet href=https://blog.bing0ne.com/css/remixicon.css><link rel=stylesheet href=https://blog.bing0ne.com/css/zozo.css><link rel=stylesheet href=https://blog.bing0ne.com/css/highlight.css></head><body><div class="main animated"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>Home</a></li><li><a href=/posts/>Archive</a></li><li><a href=/tags/>Tags</a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=remixicon-links-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=https://blog.bing0ne.com><span>bing0ne Base</span>
<img src=https://blog.bing0ne.com/images/logo.svg></a></h1></div><div class=description><p class=sub_title>Neverland</p><div class=my_socials><a href=https://github.com/bing0n3 title=github target=_blank><i class=remixicon-github-fill></i></a><a href=https://instagram.com/bing0n3 title=instagram target=_blank><i class=remixicon-instagram-fill></i></a><a href=https://twitter.com/bing0n3 title=twitter target=_blank><i class=remixicon-twitter-fill></i></a><a href=https://blog.bing0ne.com/index.xml type=application/rss+xml title=rss target=_blank><i class=remixicon-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animated fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/go-slice/>Go中Slice的总结</a></h2><span class=date>2019.01.30</span></div><div class="post_content markdown"><p>在刷leetcode的78题的时候，遇到了对slice的append的bug。</p><pre><code class=language-go>func subsets(nums []int) [][]int {
    ans := [][]int{[]int{}}

	for _, n := range nums {
		newSets := make([][]int, 0)
		for _, set := range ans {
			tmp := make([]int, len(set)+1)
          tmp = append(set,n)
          fmt.Printf(&quot;%v\n&quot;,ans)
          fmt.Printf(&quot;%d, %v, 变量的地址: %p, %v \n&quot;, n,set,&amp;set, tmp)
			newSets = append(newSets, tmp)
		}
		ans = append(ans, newSets...)
	}
	return ans
}
</code></pre><p>我们发现<code>[9,0,3]</code>和<code>[9,0,3,5]</code>共享一个底层数组, 当我们向<code>[9,0,3]</code> <code>append</code>一个7的时候，我们会覆盖<code>[9,0,3,5]</code>中的5，变为<code>[9,0,3,7]</code>。为了解决这个问题我们需要使用<code>copy</code>，为每一个append后的切片创建一个新的数组。</p><pre><code>copy(tmp, append(set, n))
</code></pre><h2 id=关于slice>关于Slice</h2><p>那么为什么会造成这个上面的这个bug呢？ 这和go中<code>slice</code>和<code>append</code>的性质都有关。 在<strong>Go中数组是一个值</strong>，而不是像在C中的那样是一个指向第一个元素的指针。而<code>slice</code>在一定程度上更像C中的数组，<code>slice</code>是对一个数组片段的描述，它由指向数组的指针，长度(length)和容量(capacity)构成。同时切片化的操作，就是创建一个指向原数组的新的切片值。</p><h2 id=关于append>关于Append</h2><pre><code class=language-go>func append(slice []Type, elems ...Type) []Type
</code></pre><p><code>append</code>， 当空间(capacity)足够时候，会直接加在slice的尾部，这时候如果slice指向的数组是一个空间足够的数组的，会直接在slice的末尾，覆盖原数组中的数(e.g. a [1,2,3,4];slice 取 [0,1] ,增加一个1，则原数组会变为[1,2,1,3]) 或者增加一个数。如果空间不够的情况下，我们会重新分配一个数组。</p><pre><code class=language-go>a := []int{1, 2, 3, 4, 5, 6, 7, 8}
b := []int{1, 2, 3, 4, 5, 6, 7, 8}

slice := a[0:2]
d := append(slice, 1)

fmt.Println(a)
fmt.Println(b)
fmt.Println(d)

/* output
[1 2 1 4 5 6 7 8]
[1 2 3 4 5 6 7 8]
[1 2 1]
*/
</code></pre><h2 id=关于for-range>关于For Range</h2><p>关于<code>for range</code>,则是意外的收获， 我们发现在<code>For-range</code>会使用同一块内存去接收循环中的值。</p><pre><code class=language-go>h := [][]int{[]int{}}
f := [][]int{[]int{1, 2, 3, 4}, []int{4, 5, 6, 7}}

for i, z := range f {
	tmp := append(z, i)
	fmt.Printf(&quot;变量的地址: %p\n&quot;, &amp;z)
	h = append(h, tmp)
	fmt.Println(tmp)
}

/*
output:
变量的地址: 0xc00000a0e0
变量的地址: 0xc00000a0e0
*/
</code></pre></div><div class=post_footer><div class=meta><div class=info><span class="field tags"><i class=remixicon-stack-line></i><a href=https://blog.bing0ne.com/tags/go/>go</a></span></div></div></div></div></div></div><a id=back_to_top href=# class=back_to_top><span>△</span></a></div><footer class=footer><div class=powered_by><a href=https://zeuk.me>Designed by Zeuk,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=footer_slogan><span>Share Memory by Communication</span></div></footer><script src=https://blog.bing0ne.com/js/jquery-3.3.1.min.js></script><script src=https://blog.bing0ne.com/js/zozo.js></script><script src=https://blog.bing0ne.com/js/highlight.pack.js></script><link href=https://blog.bing0ne.com/css/fancybox.min.css rel=stylesheet><script src=https://blog.bing0ne.com/js/fancybox.min.js></script><script>hljs.initHighlightingOnLoad()</script><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\[\[','\]\]']],processEscapes:true,processEnvironments:true,skipTags:['script','noscript','style','textarea','pre'],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}});MathJax.Hub.Queue(function(){var all=MathJax.Hub.getAllJax(),i;for(i=0;i<all.length;i+=1){all[i].SourceElement().parentNode.className+=' has-jax';}});</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-71832126-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"bing0ne"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></body></html>